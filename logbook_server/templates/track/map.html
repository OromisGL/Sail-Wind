{% extends 'base.html' %}


{% block title %}
    Map
{% endblock %}


{% block content %}

    <div class="container-fluid vh-100 d-flex flex-column p-0 m-0">
        <div class="row flex-grow-1 overflow-hidden m-0 p-0">  <!-- overflow-hidden verhindert Scrollen -->
            <div class="col-12 p-0 m-0">
                <div id="map" class="w-100 h-100 position-relative"> 
                    {{ map_data|safe }}
                    <div id="wind-info" style="position: absolute; width: 180px; bottom: 75px; left: 10px; z-index: 9999; font-size: 14px; background: rgba(255, 255, 255, 0.7); padding: 10px; border-radius: 10px;">
                        <p><b>Wind Data</b></p>
                        <p id="wind-speed">Velocity: {{ wind_speed }} m/s</p>
                        <p id="wind-strength">Wind Strength: {{ getBeauforScale }}</p>
                        <p id="wind-direction">Direction: {{ compass_direction }}</p>
                        <img id="wind-arrow" src="data:image/png;base64,{{ wind_arrow }}" style="position: absolute; width: 50px; left: 125px; top: 100px;">
                        <img id="DWD-Logo" src="data:image/png;base64,{{ DWD_logo }}" style="position: relative; height: 25px; left: 100px; top: 75px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function fetchWindData() {
            fetch(`/track/api/wind?lat=52.924095&lon=13.713948`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    updateMapWithWindData(
                        data.wind_speed,
                        data.wind_direction,
                        data.compass_direction,
                        data.beaufort
                    );
                })
                .catch(error => console.error('Error fetching wind data:', error));
        }
        function updateMapWithWindData(wind_speed, wind_direction, compass_direction, beaufort) {
            document.getElementById('wind-speed').textContent = `Velocity: ${wind_speed} m/s`;
            document.getElementById('wind-strength').textContent = `Wind Strength: ${beaufort}`;
            document.getElementById('wind-direction').textContent = `Direction: ${compass_direction}`;
            document.getElementById('wind-arrow').style.transform = `rotate(${wind_direction}deg)`;
            document.getElementById('wind-info').style.display = 'block';
        }
        setInterval(fetchWindData, 10000);
    </script>
{% endblock %}